\section{Choice of Operating System}\label{OS}
Before implementing the different software components, it is necessary to choose an operating system (OS) for the NXT brick. This section will cover this selection, by examining different possible operating systems, along with their strengths and weaknesses. The OS is required to be a real-time OS (RTOS), in order to ensure that different tasks are run within a given deadline. After a suitable RTOS has been chosen, the features supported by the RTOS will be examined, including the scheduler being used. 

%In this section the operating system in use for the project will be described, and there will be reasoned in the choice of operating system. Furthermore the scheduler running on the OS will specified. The chosen OS needed to have an rts scheduler or the ability to make a custom scheduler, there are then several things that would be nice to have available for the development but is not strictly necessary. 

\subsection{Comparison of Possible RTOS}\label{osek}
There are several operating systems available for the NXT platform, with different advantages and disadvantages. Team Hassenplug~\cite{OSChoice} compares certain key aspects of some widely used OS possibilities for the NXT, and two different operating systems were suitable for this project, due to their supported programming languages, and their support for floating point operations. These two operating systems are RobotC, and nxtOSEK which appears in the comparison under the former name LEJOS OSEK. Both these OS support floating point operations, which is very advantageous, as it simplifies some of the calculations. RobotC has an advantage in its support of datalogging, which is not supported by nxtOSEK. However, nxtOSEK does support bluetooth communication, providing the possibility of sending data to a computer, effectively affording datalogging functionality for the nxtOSEK. As RobotC requires payment, while nxtOSEK does not, the latter was chosen as the OS for the LEGO NXT. RobotC does not have a real-time scheduler, but it is still possible to make Cyclic Executive scheduling. nxtOSEK has a rate-monotonic scheduler that is more than sufficient for a real-time system.

%both of them had floating points which will make some calculations easier to handle. RobotC got data logging and LEJOS OSEK dont haveing the ability to datalog would be preferable as it would make it easyer to find trends in the data if it was off loaded, LEJOS OSEK is able to use bluetooth to communicate with a PC and send data that way, bluetooth can then be used for data logging. RobotC got a file system and a memory of 561 bytes it might make a difference but not one that we plan to use. As RobotC is not free and LEJOS OSEK is OSEK were chosen for this project.

\subsubsection{nxtOSEK}
nxtOSEK supports the programming language \emph{C}, and includes APIs for most official LEGO sensors and actuators. nxtOSEK supports two types of scheduling. The first one is event driven, where tasks are activated by an event. In some cases, this method is not schedulable in a real-time system. The other is rate-monotonic scheduling, where the tasks are given a priority, and a period in milliseconds. When the period of a task is reached it will be released, and put in the queue. If it has a higher priority than the currently running task, the running task will be preempted. Periods are static and cannot be changed. The only way a task can get a higher priority is by priority inheritance. If two tasks have a shared resource, the priority of the resource will be equal to the highest priority from the two tasks. When a task acquires a resource, it will also get the priority of the resource, ensuring that a low priority task cannot block a high priority task. Tasks are given priority based on their period. The tasks with the lowest periods are given the highest priority and vice versa. Rate-monotonic scheduling is used in real-time systems as it is easy to implement, and it can provide a guarantee that it will never miss a deadline if the actual worst-case execution times are found. 




%Valg af tekno -> nxtOSEK (C & floatingpoints) + evt. scheduling
%OSEK = eneste realtidssystem (styre scheduling), C er hurtigt, floating point for pr√¶cision
%http://www.teamhassenplug.org/NXT/NXTSoftware.html
