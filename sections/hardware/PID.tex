\subsection{Proportional integral derivative controller}\label{hardware:PID}
A proportional-integral-derivative (PID) controller is a commonly used control system. It can be used on a variety of systems and is a popular control system, partly because of its robustness and simplicity, but also because it can be used in many systems with only small changes. A PID controller is based on a control feedback loop, where the first execution of the loop only uses the current state and the goal state in the calculations. Subsequent executions of the loop uses information about the effects the previous loops had on the system. %\Cref{PID Diagram} shows a graphical representation of a PID controller. To get the current \emph{error}, the goal state, called \emph{Set Point} in \cref{PID Diagram}, is subtracted from the current state of the system which is measured by one or more sensors. The error is used to calculate all three terms, which will be explained later in this section. The sum of the three terms is calculated and fed into a control device, that sends it to an actuator. The output y(t) is the change at a given time, and is measured by a sensor. 
\\

The PID takes two inputs: the target state and the current state. It also has two static variables: \textit{lasterror} and \textit{integrale}. \textit{Integrale} sums up all the errors and \textit{lasterror} keeps the error from last time the function was called. This information is used in the derivative term. The variable \textit{error}, see \cref{pidpseudo1}, is used to determine how far the system is from the target; the bigger the error is, the more the system has to react in order to reach the target. The error influences all the other terms. The \textit{P} term is the main term of a PID. Both \textit{I} and \textit{D} are used to stabilize the system in different ways, therefor $K_p$ is usually the biggest coefficient. The magnitude of the proportional term is decided by the size of $K_p$.\\

\textit{Integrale} is the sum of all errors. This is needed if the system is close to the target, \textit{P} and \textit{D} might approach 0 and as such do nothing to change the state. If there is a small error, \textit{I} is slowly growing and will eventually start changing the system - this kind of problem is called steady-state-error. The magnitude of the \textit{integrale} term is decided by the size of $K_i$.\\

\textit{Derivative} is the changes that have happened since the last run. It is used to stabilize the system faster, it attempts to predict the future. The magnitude of the derivative term is decided by the size of $K_d$. It is not used often in real world systems as its impact on the system varies \cite{PIDcontrolsystem}.

\begin{lstlisting}[language=C, label={pidpseudo1}, caption={Pseudo code of a PID}]
//K_p, K_i and K_D are the PID coefficients that have been predefined
lasterror = 0
integrale = 0
PID(target, current)
    error = target - current
    integrale = integrale + error
    derivative = lasterror - error
    lasterror = error

    return Kp * error + Ki * integrale + Kd * derivative
\end{lstlisting}


\subsubsection{PID tuning}
In order to make the PID controller work properly the three coefficients need to be tuned. There are several methods available for PID tuning, however, only two will be described here: manual tuning and the Ziegler-Nichols Method. \\

The Ziegler-Nichols Method is a well defined method used to tune a PID controller. The first step of the method is so set $K_i$ and $K_d$ to 0. $K_p$ is then slowly increased until the motor oscillates. $T_u$ is the rate at which it oscillates, and $K_u$ is the $K_p$ value at which it oscillates.The three PID terms can then be calculated as shown in \cref{Ziegler-Nichols_Method}. This way of tuning is aggressive and will result in a fast rise, it might even result in some overshoot. \\

Another method of system tuning is manual tuning. Using this method it is necessary to know which effect different changes to the coefficients have on the system. This information can be gathered from a tuning table, such as \cref{Manual-tuning}, and then the coefficients can be tuned through a trial-and-error approach. \\


The rise time is the time it takes the system to reach the goal for the first time. A high rise time tends to result in overshoot. Overshoot is the amount by which the system exceeds the target. In a fragile system overshoot may be prohibited. The settling time is the time it takes for the system to reach a state where its states do not change any longer. A steady-state error occurs when the system has settled, but has not reached the target state. An unstable system will be unreliable as it will keep over- and undershooting while not reaching the target state in a timely manner.

\input{sections/tables/ziegler.tex}
\medskip
\input{sections/tables/manualtuning.tex}

